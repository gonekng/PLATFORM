import time
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys

def crawl(driver):

    # url 접근
    driver.get("https://www.pedsis.co.kr//htmlPage.do?p_html_page=cmmn/login")

    # 로그인
    input_id = driver.find_element(By.CSS_SELECTOR, "input.mgt2.login_id")
    input_pw = driver.find_element(By.CSS_SELECTOR, "input.mgt3.login_passw")
    input_id.send_keys('BIGBANG')
    input_pw.send_keys('big0076')
    login_box = driver.find_element(By.XPATH, "//a[@class='intro_btn_login fr']")
    login_box.click()
    print("로그인 완료")
    time.sleep(1)

    # 경고창
    driver.get("https://www.pedsis.co.kr/htmlPage.do?p_html_page=cmmn/mainFrame")
    alert = driver.switch_to.alert
    alert.accept()
    print("경고창 확인")

    # 팝업창 닫기
    popups = driver.window_handles
    for i in popups:
        if i != popups[0]:
            driver.switch_to.window(i)
            driver.close()
    driver.switch_to.window(popups[0])
    print("팝업창 종료")

    # 비밀번호 다음에 변경
    driver.switch_to.frame('mainFrame')
    driver.execute_script("fn_passwordSession('N')")
    print("비밀번호 다음에 변경")

    # 국내소비 접근
    driver.switch_to.frame('topFrame')
    driver.execute_script("doLeftMain('10004')")
    print("국내소비 클릭")
    driver.execute_script("goMenu('https://biweb.pedsis.co.kr/analytics/saw.dll?Dashboard&PortalPath=%2Fshared%2F%EA%B5%AD%EB%82%B4%EC%86%8C%EB%B9%84%2F_portal%2F%EA%B5%AD%EB%82%B4%EC%86%8C%EB%B9%84%ED%98%84%ED%99%A9_10227&page=%EA%B5%AD%EB%82%B4%EC%86%8C%EB%B9%84%ED%98%84%ED%99%A9', 'D', '1', '10227')")
    print("국내소비현황 클릭")
    time.sleep(5)

def main():
    
    # webdriver 객체 생성
    browser = webdriver.Chrome()
    browser.maximize_window()
    browser.implicitly_wait(10)

    crawl(browser)
    browser.close()

if __name__ == "__main__":
    main()